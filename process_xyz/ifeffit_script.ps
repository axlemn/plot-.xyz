#!/usr/bin/perl

use Ifeffit;
# Take in dir_name
$dir_name = $ARGV[0];
@index = ();

# Get number of feff data files in directory.
opendir(DIR, $dir_name) or die $!; 

while (my $_ = readdir(DIR)) {

    # Only want files
    next unless (-f "$dir_name/$_");
    # Use a regular expression to find files
    if (/feff(\d{4}).dat/) {
        my $num = $1;
        push(@index, $num);
    }

    $max_index += 1;
}
closedir(DIR);

foreach my $i (@index) {
@a[0] = ifeffit("path(" . $i . ", file = " . 
    $dir_name . 
    "/feff" . 
    sprintf("%04d", $i) .
    ".dat)");
}

$a = "";
foreach my $j (@index) {
    if ($j > "1") {
        $a .= ", $j";
    } else {
        $a = "1";
    }
}
print $a;

@a[2] = ifeffit("ff2chi(" .
    $a . 
    ", group = ff)");
@a[3] = ifeffit("show ff.chi");
@a[4] = ifeffit("show ff.k");
@a[5] = ifeffit("plot(ff.k, ff.chi)");
